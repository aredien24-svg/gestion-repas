<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Planning Repas</title>
    <style>
        body { font-family: Arial, sans-serif; }
        table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
        th { background-color: #f4f4f4; }
        .btn { padding: 5px 10px; cursor: pointer; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                 background-color: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
        .modal-content { background-color: #fff; padding: 20px; border-radius: 5px; width: 500px; }
    </style>
</head>
<body>

<h1>Planning des repas</h1>

<!-- Formulaire création planning -->
<div>
    <h2>Créer un planning</h2>
    <label>Mois: <input type="number" id="month" min="1" max="12"></label>
    <label>Année: <input type="number" id="year" min="2024" max="2100"></label>
    <button class="btn" onclick="createPlanning()">Créer</button>
</div>

<!-- Table des plannings -->
<h2>Plannings existants</h2>
<table id="planningTable">
    <thead>
        <tr>
            <th>Mois</th>
            <th>Année</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        <!-- Les plannings seront insérés ici -->
    </tbody>
</table>

<!-- Modal de détail planning -->
<div id="modal" class="modal">
    <div class="modal-content">
        <h3>Détail du planning</h3>
        <table id="detailTable">
            <thead>
                <tr>
                    <th>Jour</th>
                    <th>Midi</th>
                    <th>Soir</th>
                    <th>Stage</th>
                    <th>Vacances</th>
                </tr>
            </thead>
            <tbody>
                <!-- Les jours seront générés ici -->
            </tbody>
        </table>
        <button class="btn" onclick="closeModal()">Fermer</button>
    </div>
</div>

<script>
let plannings = []; // Contiendra les plannings créés
let currentPlanningIndex = null;

// Création d'un planning
function createPlanning() {
    const month = parseInt(document.getElementById('month').value);
    const year = parseInt(document.getElementById('year').value);
    if (!month || !year) {
        alert("Veuillez remplir mois et année.");
        return;
    }

    const newPlanning = { month, year, days: [] };
    const daysInMonth = new Date(year, month, 0).getDate();

    for (let i = 1; i <= daysInMonth; i++) {
        newPlanning.days.push({
            day: i,
            midi: false,
            soir: false,
            stage: false,
            vacances: false
        });
    }

    plannings.push(newPlanning);
    renderPlannings();
}

// Affichage des plannings
function renderPlannings() {
    const tbody = document.querySelector("#planningTable tbody");
    tbody.innerHTML = "";
    plannings.forEach((planning, index) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${planning.month}</td>
            <td>${planning.year}</td>
            <td>
                <button class="btn" onclick="openModal(${index})">Voir / Modifier</button>
                <button class="btn" onclick="deletePlanning(${index})">Supprimer</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

// Supprimer un planning
function deletePlanning(index) {
    if (confirm("Voulez-vous vraiment supprimer ce planning ?")) {
        plannings.splice(index, 1);
        renderPlannings();
    }
}

// Ouvrir modal
function openModal(index) {
    currentPlanningIndex = index;
    renderAdminReports();
    document.getElementById('modal').style.display = "flex";
}

// Fermer modal
function closeModal() {
    document.getElementById('modal').style.display = "none";
}
// Affichage du détail du planning dans le modal
function renderAdminReports() {
    const tbody = document.querySelector("#detailTable tbody");
    tbody.innerHTML = "";

    const planning = plannings[currentPlanningIndex];
    planning.days.forEach((day, i) => {
        const tr = document.createElement("tr");

        tr.innerHTML = `
            <td>${day.day}</td>
            <td><input type="checkbox" ${day.midi ? "checked" : ""} onclick="toggleDay(${i}, 'midi')"></td>
            <td><input type="checkbox" ${day.soir ? "checked" : ""} onclick="toggleDay(${i}, 'soir')"></td>
            <td><input type="checkbox" ${day.stage ? "checked" : ""} onclick="toggleDay(${i}, 'stage')"></td>
            <td><input type="checkbox" ${day.vacances ? "checked" : ""} onclick="toggleDay(${i}, 'vacances')"></td>
        `;

        tbody.appendChild(tr);
    });
}

// Modifier un jour
function toggleDay(dayIndex, type) {
    const planning = plannings[currentPlanningIndex];
    planning.days[dayIndex][type] = !planning.days[dayIndex][type];
}

// Fermer modal et re-rendre les plannings (si nécessaire)
function closeModal() {
    document.getElementById('modal').style.display = "none";
    renderPlannings();
}

// Fermer modal si clic à l'extérieur
window.onclick = function(event) {
    const modal = document.getElementById('modal');
    if (event.target === modal) {
        closeModal();
    }
}
</script>

</body>
</html>
